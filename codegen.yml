schema: schema.graphql
documents:
  - ./src/**/*.graphql
overwrite: true
hooks:
  afterAllFileWrite:
    - eslint --fix --ext .generated.ts
generates:
  # Generate fragment matcher for Apollo's caching
  ./src/api/fragmentMatcher.generated.ts:
    plugins:
      - add: /* eslint-disable import/no-default-export */
      - fragment-matcher
      - add:
          placement: append
          content: export const possibleTypes = result.possibleTypes;
    config:
      apolloClientVersion: 3

  # Generate type policies so custom scalars can be parsed automatically
  ./src/api/scalars/scalars.generated.ts:
    plugins:
      - ./src/api/scalars/scalars.codegen
    config:
      parserImport: ./scalars.parser

  # Generate TypeScript version of graphql schema
  ./src/api/schema.generated.ts:
    plugins:
      - typescript
      - add:
          placement: prepend
          content: |
            import { DateTime } from 'luxon';
            import { CalendarDate } from '../util';
    config:
      reactApolloVersion: 3
      scalars:
        Date: CalendarDate
        DateTime: DateTime
      skipTypename: false
      enumsAsTypes: true

  # Generate an object housing all of our operations
  # This allows operations to be cross-referenced (i.e. `refetchQueries`) without needing to rely on magic strings
  ./src/api/operations.generated.ts:
    plugins:
      - named-operations-object
    config:
      identifierName: GQLOperations

  # Generate types & react hooks for our operations
  ./src/:
    preset: near-operation-file
    presetConfig:
      extension: .generated.ts
      baseTypesPath: api/schema.generated.ts
    plugins:
      # import/no-duplicates is here until hooks & common can be merged into one import
      - add: /* eslint-disable import/no-duplicates, @typescript-eslint/no-empty-interface */
      - typescript-operations
      - typescript-react-apollo
    config:
      reactApolloVersion: 3
      scalars:
        Date: string
        DateTime: string
      skipTypename: false
      withHooks: true
      withHOC: false
      withComponent: false
      enumsAsTypes: true
